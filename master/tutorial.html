<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; LCLS Lightpath 1.0.2.dev58+g02073a5 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Device Interface" href="interface.html" />
    <link rel="prev" title="LCLS Lightpath" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            LCLS Lightpath
          </a>
              <div class="version">
                1.0.2.dev58+g02073a5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Controlling the beamline</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#device-manipulation">Device Manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#branching-logic-and-graph-construction">Branching Logic, and Graph Construction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lcls-specific-notes">LCLS Specific Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="interface.html">Device Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller.html">LightController</a></li>
<li class="toctree-l1"><a class="reference internal" href="path.html">BeamPath</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="upcoming_changes.html">Upcoming Changes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">LCLS Lightpath</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h1>
<section id="device-manipulation">
<h2>Device Manipulation<a class="headerlink" href="#device-manipulation" title="Permalink to this heading"></a></h2>
<p>The lightpath abstracts control of multiple devices into a single beampath
object. Actual device instantiation should be handled else where the lightpath
just assumes that you give it a list of devices that match the
<code class="xref py py-class docutils literal notranslate"><span class="pre">LightInterface</span></code>. For now we can demonstrate the basic features of the
API by using a simulated path.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">lightpath.tests</span>

<span class="go"># Return a simple simulated path</span>
<span class="gp">In [2]: </span><span class="n">path</span> <span class="o">=</span> <span class="n">lightpath</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>

<span class="go"># Return a mock lcls facility</span>
<span class="gp">In [3]: </span><span class="n">lcls</span> <span class="o">=</span> <span class="n">lightpath</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">lcls</span><span class="p">()</span>
</pre></div>
</div>
<p>You can look at all the devices in the path, either by looking at the objects
themselves or using the <a class="reference internal" href="path.html#lightpath.path.BeamPath.show_devices" title="lightpath.path.BeamPath.show_devices"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BeamPath.show_devices()</span></code></a></p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">path</span><span class="o">.</span><span class="n">show_devices</span><span class="p">()</span>
<span class="go">+-------+--------+----------+----------------+-----------------+---------+</span>
<span class="go">| Name  | Prefix | Position | Input Branches | Output Branches |   State |</span>
<span class="go">+-------+--------+----------+----------------+-----------------+---------+</span>
<span class="go">| zero  | zero   |  0.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Removed |</span>
<span class="go">| one   | one    |  2.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Removed |</span>
<span class="go">| two   | two    |  9.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Removed |</span>
<span class="go">| three | three  | 15.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Removed |</span>
<span class="go">| four  | four   | 16.00000 |        [&#39;TST&#39;] |  [&#39;TST&#39;, &#39;SIM&#39;] | Removed |</span>
<span class="go">| five  | five   | 24.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Removed |</span>
<span class="go">| six   | six    | 24.20000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Removed |</span>
<span class="go">| seven | seven  | 24.40000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Removed |</span>
<span class="go">| eight | eight  | 24.60000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Removed |</span>
<span class="go">| nine  | nine   | 24.80000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Removed |</span>
<span class="go">| ten   | ten    | 30.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Removed |</span>
<span class="go">+-------+--------+----------+----------------+-----------------+---------+</span>

<span class="gp">In [5]: </span><span class="n">path</span><span class="o">.</span><span class="n">devices</span>
<span class="gh">Out[5]: </span>
<span class="go">(IPIMB(prefix=&#39;eight&#39;, name=&#39;eight&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> IPIMB(prefix=&#39;five&#39;, name=&#39;five&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> Crystal(prefix=&#39;four&#39;, name=&#39;four&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;, &#39;_inserted_branch&#39;], configuration_attrs=[]),</span>
<span class="go"> IPIMB(prefix=&#39;nine&#39;, name=&#39;nine&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> Valve(prefix=&#39;one&#39;, name=&#39;one&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> IPIMB(prefix=&#39;seven&#39;, name=&#39;seven&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> IPIMB(prefix=&#39;six&#39;, name=&#39;six&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> Valve(prefix=&#39;ten&#39;, name=&#39;ten&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> Valve(prefix=&#39;three&#39;, name=&#39;three&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> Stopper(prefix=&#39;two&#39;, name=&#39;two&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> Valve(prefix=&#39;zero&#39;, name=&#39;zero&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]))</span>
</pre></div>
</div>
<p>Now lets insert some devices and see how we can quickly find what is blocking
the instrument. The lightpath module differentiates between two kinds of
inserted devices, <code class="docutils literal notranslate"><span class="pre">blocking</span></code> and <code class="docutils literal notranslate"><span class="pre">incident</span></code>. The first is a device that
will prevent beam from transmitting through it i.e a stopper or YAG. The second
includes slightly more complex, but essentially is any device that can be
inserted in to the beam, but won’t greatly affect operation i.e an IPIMB. The
difference between the two is determined by comparing the devices
<code class="docutils literal notranslate"><span class="pre">transmission</span></code> attribute against <a class="reference internal" href="path.html#lightpath.path.BeamPath.minimum_transmission" title="lightpath.path.BeamPath.minimum_transmission"><code class="xref py py-attr docutils literal notranslate"><span class="pre">BeamPath.minimum_transmission</span></code></a>.</p>
<p>Note that these simulated devices have <code class="docutils literal notranslate"><span class="pre">.insert()</span></code> and <code class="docutils literal notranslate"><span class="pre">.remove()</span></code> methods for
convenience of testing, but real devices may not.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">path</span><span class="o">.</span><span class="n">cleared</span>
<span class="gh">Out[6]: </span><span class="go">True</span>

<span class="gp">In [7]: </span><span class="n">path</span><span class="o">.</span><span class="n">five</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span>
<span class="gh">Out[7]: </span><span class="go">DeviceStatus(device=five, done=False, success=False)</span>

<span class="gp">In [8]: </span><span class="n">path</span><span class="o">.</span><span class="n">six</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span>
<span class="gh">Out[8]: </span><span class="go">DeviceStatus(device=six, done=False, success=False)</span>

<span class="gp">In [9]: </span><span class="n">path</span><span class="o">.</span><span class="n">cleared</span>
<span class="gh">Out[9]: </span><span class="go">True</span>

<span class="gp">In [10]: </span><span class="n">path</span><span class="o">.</span><span class="n">incident_devices</span>
<span class="gh">Out[10]: </span>
<span class="go">[IPIMB(prefix=&#39;five&#39;, name=&#39;five&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> IPIMB(prefix=&#39;six&#39;, name=&#39;six&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[])]</span>

<span class="gp">In [11]: </span><span class="n">path</span><span class="o">.</span><span class="n">blocking_devices</span>
<span class="gh">Out[11]: </span><span class="go">[]</span>

<span class="gp">In [12]: </span><span class="n">path</span><span class="o">.</span><span class="n">show_devices</span><span class="p">()</span>
<span class="go">+-------+--------+----------+----------------+-----------------+----------+</span>
<span class="go">| Name  | Prefix | Position | Input Branches | Output Branches |    State |</span>
<span class="go">+-------+--------+----------+----------------+-----------------+----------+</span>
<span class="go">| zero  | zero   |  0.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] |  Removed |</span>
<span class="go">| one   | one    |  2.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] |  Removed |</span>
<span class="go">| two   | two    |  9.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] |  Removed |</span>
<span class="go">| three | three  | 15.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] |  Removed |</span>
<span class="go">| four  | four   | 16.00000 |        [&#39;TST&#39;] |  [&#39;TST&#39;, &#39;SIM&#39;] |  Removed |</span>
<span class="go">| five  | five   | 24.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Inserted |</span>
<span class="go">| six   | six    | 24.20000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] | Inserted |</span>
<span class="go">| seven | seven  | 24.40000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] |  Removed |</span>
<span class="go">| eight | eight  | 24.60000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] |  Removed |</span>
<span class="go">| nine  | nine   | 24.80000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] |  Removed |</span>
<span class="go">| ten   | ten    | 30.00000 |        [&#39;TST&#39;] |         [&#39;TST&#39;] |  Removed |</span>
<span class="go">+-------+--------+----------+----------------+-----------------+----------+</span>
</pre></div>
</div>
<p>The most upstream blocking device by checking the <a class="reference internal" href="path.html#lightpath.path.BeamPath.impediment" title="lightpath.path.BeamPath.impediment"><code class="xref py py-attr docutils literal notranslate"><span class="pre">BeamPath.impediment</span></code></a></p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">path</span><span class="o">.</span><span class="n">impediment</span> <span class="o">==</span> <span class="n">path</span><span class="o">.</span><span class="n">six</span>
<span class="gh">Out[13]: </span><span class="go">False</span>

<span class="gp">In [14]: </span><span class="n">path</span><span class="o">.</span><span class="n">two</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span>
<span class="gh">Out[14]: </span><span class="go">DeviceStatus(device=two, done=False, success=False)</span>

<span class="gp">In [15]: </span><span class="n">path</span><span class="o">.</span><span class="n">impediment</span> <span class="o">==</span> <span class="n">path</span><span class="o">.</span><span class="n">two</span>
<span class="gh">Out[15]: </span><span class="go">True</span>

<span class="gp">In [16]: </span><span class="n">path</span><span class="o">.</span><span class="n">blocking_devices</span>
<span class="gh">Out[16]: </span>
<span class="go">[Stopper(prefix=&#39;two&#39;, name=&#39;two&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> IPIMB(prefix=&#39;five&#39;, name=&#39;five&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[]),</span>
<span class="go"> IPIMB(prefix=&#39;six&#39;, name=&#39;six&#39;, read_attrs=[&#39;current_state&#39;, &#39;current_transmission&#39;, &#39;current_destination&#39;], configuration_attrs=[])]</span>
</pre></div>
</div>
</section>
<section id="branching-logic-and-graph-construction">
<h2>Branching Logic, and Graph Construction<a class="headerlink" href="#branching-logic-and-graph-construction" title="Permalink to this heading"></a></h2>
<p>In order to determine the state of the “beamline”, Lightpath must first
understand where the various devices lie along the beam path.  Lightpath does
this by constructing a Directed Graph with the devices as nodes. This
formulation allows Lightpath to find any and all valid paths to any given
device, given the state of the facility at that time.</p>
<p>In order to do this, each device considered by lightpath must carry with
it the following metadata:</p>
<ul class="simple">
<li><p>input branches</p></li>
<li><p>output branches</p></li>
<li><p>z-position</p></li>
</ul>
<p>This is the minimum information needed to place a device in the facility graph.
To simplify matters for the user, lightpath orders devices on the same
branch by their z-position, or distance from the light source.</p>
<p>For more implementation details (device API, happi database information)
see the <a class="reference internal" href="interface.html#interface-api"><span class="std std-ref">Device Interface</span></a> section</p>
</section>
<section id="lcls-specific-notes">
<h2>LCLS Specific Notes<a class="headerlink" href="#lcls-specific-notes" title="Permalink to this heading"></a></h2>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/LCLS_beamline_map.svg"><img alt="Schematic of LCLS facility, with branch names (red) and branching devices (blue) labeled." src="_images/LCLS_beamline_map.svg" width="100%" /></a>
</figure>
<p>The way Lightpath organizes devices (ordering devices on the same branch
by z position) is greatly motivated by the LCLS facility and its naming
conventions.  LCLS recently adopted a device naming convention that
relies heavily on this concept of branches, with branch names changing
at branching devices.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="LCLS Lightpath" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="interface.html" class="btn btn-neutral float-right" title="Device Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, SLAC National Accelerator Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>